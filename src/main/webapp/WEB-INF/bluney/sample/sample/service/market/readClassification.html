<div class="row">
	<div id="breadcrumb" class="col-md-12">
		<ol class="breadcrumb">
			<li><a href="#">Dashboard</a></li>
			<li><a href="#">Tables</a></li>
			<li><a href="#">Data Tables</a></li>
		</ol>
	</div>
</div>

<div class="row">
	<div class="col-xs-12">
		<div class="box">
			<div id="container" style="width:100%; height:400px;"></div>
			<div class="col-xs-12 col-sm-12 box-content table-responsive">
				<table id="readClassification" th:if="${total_market_entity}" class="table display table-striped table-hover table-heading table-datatable">
					<thead>
						<tr>
							<th colspan='8'>
							<span>지역별 상세 정보 : </span>
							<span th:text="${classification}"></span>
							<button class="btn pull-right" onclick="onClickGoToMainPage();">시장동향</button>
							</th>
						</tr>
						<tr>
							<th style="text-align: center;">순번</th>
							<th style="text-align: center;">DATE</th>
							<th style="text-align: center;">매매가 </th>
							<th style="text-align: center;">전세가 </th>
							<th style="text-align: center;">전세율 </th>
							<th style="text-align: center;">매매증감 </th>
							<th style="text-align: center;">전세증감 </th>
						</tr>
					</thead>
					<tfoot style="height:0px;">
					</tfoot>
					<tbody>
						<tr th:each="entity, idx : ${total_market_entity}" >
							<td style="text-align: center;" th:text="${idx.count}">1</td>
							<td style="text-align: center;" th:text="${#dates.format(entity.date, 'yyyy-MM-dd')}">1</td>
							<td style="text-align: center;" th:if="${entity.sellingPrice}" th:text="${#numbers.formatDecimal(entity.sellingPrice, 1, 0, 'POINT')}">13.10</td>
							<td style="text-align: center;" th:unless="${entity.sellingPrice}" th:text="'-'">13.10</td>
							<td style="text-align: center;" th:if="${entity.leasePrice}" th:text="${#numbers.formatDecimal(entity.leasePrice, 1, 0, 'POINT')}">13.10</td>
							<td style="text-align: center;" th:unless="${entity.leasePrice}" th:text="'-'">13.10</td>
							<td style="text-align: center;" th:if="${entity.ginRate}" >
								<span th:if="${entity.ginRate}>=80.0" style="color:#ff000a;" th:text="${#numbers.formatDecimal(entity.ginRate, 1, 2, 'POINT')}" />
								<span th:if="${entity.ginRate}>=70.0 and 80.0>${entity.ginRate}" style="color:#ff7f27;" th:text="${#numbers.formatDecimal(entity.ginRate, 1, 2, 'POINT')}" />
								<span th:if="${entity.ginRate}>=60.0 and 70.0>${entity.ginRate}" style="color:#22b14c;" th:text="${#numbers.formatDecimal(entity.ginRate, 1, 2, 'POINT')}" />
								<span th:if="60.0>${entity.ginRate} " style="color:black;" th:text="${#numbers.formatDecimal(entity.ginRate, 1, 2, 'POINT')}" />
							</td>
							<td style="text-align: center;" th:unless="${entity.ginRate}" th:text="'-'">13.10</td>
							<td style="text-align: center;" th:if="${entity.ginSelling}">
								<span th:if="${entity.ginSelling}>=6.0" style="color:#ff000a;" th:text="${#numbers.formatDecimal(entity.ginSelling, 1, 2, 'POINT')}" />
								<span th:if="${entity.ginSelling}>=4.0 and 6.0>${entity.ginSelling}" style="color:#ff7f27;" th:text="${#numbers.formatDecimal(entity.ginSelling, 1, 2, 'POINT')}" />
								<span th:if="${entity.ginSelling}>=2.0 and 4.0>${entity.ginSelling}" style="color:#22b14c;" th:text="${#numbers.formatDecimal(entity.ginSelling, 1, 2, 'POINT')}" />
								<span th:if="2.0>${entity.ginSelling} " style="color:black;" th:text="${#numbers.formatDecimal(entity.ginSelling, 1, 2, 'POINT')}" />
							</td>
							<td style="text-align: center;" th:unless="${entity.ginSelling}" th:text="'-'">13.10</td>
							<td style="text-align: center;" th:if="${entity.ginLease}">
								<span th:if="${entity.ginLease}>=6.0" style="color:#ff000a;" th:text="${#numbers.formatDecimal(entity.ginLease, 1, 2, 'POINT')}" />
								<span th:if="${entity.ginLease}>=4.0 and 6.0>${entity.ginLease}" style="color:#ff7f27;" th:text="${#numbers.formatDecimal(entity.ginLease, 1, 2, 'POINT')}" />
								<span th:if="${entity.ginLease}>=2.0 and 4.0>${entity.ginLease}" style="color:#22b14c;" th:text="${#numbers.formatDecimal(entity.ginLease, 1, 2, 'POINT')}" />
								<span th:if="2.0>${entity.ginLease} " style="color:black;" th:text="${#numbers.formatDecimal(entity.ginLease, 1, 2, 'POINT')}" />
							</td>
							<td style="text-align: center;" th:unless="${entity.ginLease}" th:text="'-'">13.10</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>

<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.11/css/jquery.dataTables.min.css" />
<script src="https://code.highcharts.com/stock/highstock.js"></script>
<script src="https://code.highcharts.com/stock/modules/exporting.js"></script>
<script th:src="@{/resources/js/sample-read-classification.js}" type="text/javascript"></script>
<script th:inline="javascript">
/*<![CDATA[*/
$(document).ready(function() {
	var seriesOptions = [],
    	seriesCounter = 0,
		names = ['GinRate', 'GinSelling', 'GinLease'],
		classification = /*[[${classification}]]*/ "";
	
	function createChart() {
        $('#container').highcharts('StockChart', {
            rangeSelector: {
                selected: 4
            },
            yAxis: {
                labels: {
                    formatter: function () {
                        return (this.value > 0 ? '+' : '-') + this.value + '%';
                    }
                },
                plotLines: [{
                    value: 0,
                    width: 2,
                    color: 'silver'
                }]
            },
            plotOptions: {
                series: {
                    compare: 'percent'
                }
            },

            tooltip: {
                pointFormat: '<span style="color:{series.color}">{series.name}</span>: <b>{point.y}</b> ({point.change}%)<br/>',
                valueDecimals: 2
            },

            series: seriesOptions
        });
    }

    $.each(names, function (i, name) {
    	$.ajax({
    		url : '/service/market/totalMarket',
    		data : {'classification' : classification,
    				'type' : name},
    		success:  function (response) {
    			alert(response);
	            seriesOptions[i] = {
	                name: name,
	                data: response
	            };
	
	            // As we're loading the data asynchronously, we don't know what order it will arrive. So
	            // we keep a counter and create the chart when all the data is loaded.
	            seriesCounter += 1;
	            if (seriesCounter === names.length) {
	                createChart();
	            }
    		}
        });
    });
});
/*]]>*/
</script>